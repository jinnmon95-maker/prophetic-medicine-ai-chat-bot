import streamlit as st
import google.generativeai as genai
from gtts import gTTS
import os

# --- Configuration ---
# ‡¥§‡¥æ‡¥¥‡µÜ ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ API Key ‡¥™‡µá‡¥∏‡µç‡¥±‡µç‡¥±‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï (Quotes ‡¥â‡¥≥‡µç‡¥≥‡¥ø‡µΩ)
api_key = "AIzaSyDm58d3XLdatCra3WeU1CbAmLIKlz7eF28"

# ‡¥§‡¥æ‡¥¥‡µÜ ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ PDF-‡¥≤‡µÜ ‡¥ï‡¥£‡µç‡¥ü‡¥®‡µç‡¥±‡µç ‡¥™‡µá‡¥∏‡µç‡¥±‡µç‡¥±‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï (Quotes ‡¥â‡¥≥‡µç‡¥≥‡¥ø‡µΩ)
pdf_content = """
1. Introduction: Epistemological Foundations of Prophetic HealingThe reconstruction of Prophetic Medicine (Al-Tibb Al-Nabawi) for the purpose of developing an Artificial Intelligence expert system requires a profound alignment of theological axioms, historical text, and biomedical science. This report serves as the comprehensive knowledge base for such a system, designed to interpret user inputs regarding symptomatology and output accurate, context-aware, and religiously authenticated remedial protocols.Prophetic Medicine is not merely a collection of folk remedies; it is a complex epistemological system that integrates the metaphysical (Ghayb) with the empirical (Shahadah). It operates on the fundamental premise articulated by the Prophet Muhammad (peace be upon him): "Allah has not created a disease without appointing a remedy for it, with the exception of one disease, namely old age". This narration serves as the primary directive for the AI: the search for a cure is a religious imperative, validiating medical inquiry.For an AI architecture, it is insufficient to simply map "Headache" to "Honey." The system must understand the classification of disease‚Äîwhether it is somatic (humoral imbalance), psychological (grief/stress), or spiritual (Evil Eye/Sihr)‚Äîas elaborated by classical exegetes like Ibn al-Qayyim and Al-Suyuti. Furthermore, the system must recognize the Principle of Opposites, a heuristic derived from the Prophet's treatment of fever ("heat of Hell") with water ("cooling"), establishing a logical framework where hot ailments are treated with cold remedies and vice versa.This document provides a rigorous analysis of the pharmacopeia and therapeutic procedures sanctioned in the authentic Sunnah. It synthesizes textual evidence (Hadith), method of application (Posology), and contemporary scientific validation (Mechanism of Action) to ensure the AI chatbot delivers advice that is both religiously sound and scientifically intelligible.2. Theoretical Framework and Disease TaxonomyTo accurately parse user queries, the AI must be trained on the specific taxonomy of disease found in Prophetic traditions. The material illnesses are often described in terms of humoral balance, while non-material illnesses involve spiritual vectors.2.1 The Theology of CausalityThe Prophet affirmed the validity of Asbab (material causes). When asked if remedies prevent Allah's decree, he replied that they are part of Allah's decree. This nuance is critical for the AI's "persona"‚Äîit acts not as a replacement for divine trust (Tawakkul) but as a facilitator of the divine means. The Prophetic approach links recovery to the precise matching of medicine to the illness: "If the medicine matches the disease, it is cured by the permission of Allah". This concept of "matching" (Isabat) parallels the modern concept of targeted therapy and pharmacokinetics.2.2 Classification of AilmentsMaterial/Somatic Diseases: Ailments arising from external pathogens, diet, or internal imbalances (e.g., fever, leprosy, dropsy). The Prophet prescribed specific substance-based cures (Honey, Black Seed, Senna) for these.Structural/Traumatic Diseases: Ailments involving physical injury, displacement, or obstruction (e.g., fractures, sciatica, wounds). The Prophet prescribed physical interventions (Hijama, splinting, cautery‚Äîthough cautery is discouraged).Spiritual/Psychological Diseases: Ailments affecting the heart and soul (e.g., grief, Evil Eye, Magic). The Prophet prescribed Ruqyah (incantation), prayer, and specific foods like Talbina.3. Comprehensive Materia Medica: The RemediesThis section constitutes the primary database for the AI's "Remedy Generation" engine. Each entry details the substance, its textual basis, application protocols, and scientific correlates.3.1 Honey (Asal): The Systemic CleanserHoney holds a premier status in Prophetic Medicine, described in the Qur'an as "healing for mankind." Its application is versatile, ranging from gastrointestinal regulation to wound care.3.1.1 Textual Evidence and IndicationsThe most definitive Hadith regarding honey concerns gastrointestinal distress. A man approached the Prophet stating his brother suffered from diarrhea (loose bowels). The Prophet instructed, "Give him honey." The man returned repeatedly, claiming the condition persisted. The Prophet maintained his prescription, stating, "Allah has spoken the truth and your brother's stomach has lied," implying the presence of significant harmful matter that required purging.Key Indication: Diarrhea, abdominal pain, digestive buildup.Secondary Indications: General weakness, coughing (soothing the throat), preservation of meat/fruit.3.1.2 Application and DosageOral Administration: Mixed with water (hot or cold depending on the season). The Prophet drank it on an empty stomach to wash the villi of the stomach and open the pores of the liver.Protocol for AI: If the user reports stomach pain, the AI should recommend honey water. If the user reports "it didn't work," the AI should mimic the Prophet's persistence, suggesting continued dosage to ensure the clearing of pathogens.3.1.3 Scientific MechanismHygroscopic & Antibacterial: Honey has a low water activity and high osmolarity, which dehydrates bacteria. It is effective against enteropathogens like E. coli and Salmonella.Gastroprotection: Studies confirm honey promotes the repair of damaged intestinal mucosa and reduces the duration of viral diarrhea.Cough Suppressant: Its viscosity coats the pharynx, reducing irritation, validated by modern pediatrics as comparable to dextromethorphan.3.2 Black Seed (Al-Habbah Al-Sawdaa): The ImmunomodulatorNigella sativa is the subject of the sweeping prophetic statement: "In the Black Seed is a cure for every disease except death".3.2.1 Textual Evidence and IndicationsUniversal Applicability: The text suggests it targets the root cause of systemic failure (immune weakness).Specific Usage: It was specifically used for "cold" diseases (due to its hot nature) and respiratory congestion.3.2.2 Application and DosageOral: Eaten whole (7 seeds), ground and mixed with honey, or as an oil.Nasal (Sa'ut): For colds and viral congestion, the oil is dripped into the nose. "Five or seven drops" were mentioned in some narrations for head ailments.Topical: Applied to the skin for fungal infections or pain.3.2.3 Scientific MechanismThymoquinone (TQ): The primary bioactive compound.COVID-19 & Antiviral: Research indicates TQ binds to the main protease of SARS-CoV-2, inhibiting viral replication. It also modulates the "cytokine storm" associated with severe infection.Hematological Support: Studies show it stabilizes red blood cell membranes in thalassemia and anemia.Respiratory: Acts as a potent bronchodilator and antihistamine, validating its use for asthma and coughs.3.3 Indian Costus (Al-Qust Al-Hindi): The Anti-Inflammatory SpecialistProphetic Medicine distinguishes between two types: The Marine Costus (Qust Bahri, white and mild) and the Indian Costus (Qust Hindi, black and hot).3.3.1 Textual Evidence and IndicationsThe Prophet declared, "Use 'Ud al-Hindi, for it cures seven diseases; it is inhaled by the one suffering from throat trouble (Udhrah) and is put in the side of the mouth of one suffering from pleurisy (Dhat al-Janb)".Tonsillitis (Udhrah): Specifically for children, replacing the physical compression of tonsils.Pleurisy: Inflammation of the lung lining.Headache/Sinus: Administered nasally.3.3.2 Application and DosageInhalation (Sa'ut): Ground into powder, mixed with water/oil, and dripped into the nostrils for upper respiratory tract infections.Oral (Ladud): Administered via the side of the mouth for deep lung issues or internal inflammation.Topical: Mixed with oil for scars or pigmentation (Kalaf).3.3.3 Scientific MechanismAnti-inflammatory: Saussurea costus contains sesquiterpene lactones (costunolide) which inhibit cytokine production (TNF-alpha). This directly explains its efficacy in tonsillitis (inflammation) and pleurisy.Antimicrobial: Effective against Streptococcus species involved in throat infections.3.4 Senna (Sana): The Gastrointestinal RegulatorSenna is the primary laxative of the Prophetic pharmacopeia, preferred over harsher alternatives like Euphorbia (Shubrum).3.4.1 Textual Evidence and IndicationsThe Prophet asked a woman, "What do you use as a laxative?" She replied, "Shubrum" (Euphorbia). He said, "It is hot and harsh." Then she used Senna, and he said, "If there were a cure for death, it would be Senna".Indication: Constipation, detoxification, "Headache and Pustules" (as secondary benefits of detoxification).3.4.2 Application and DosagePreparation: Decoction (Tea). Boiling the leaves.Adjuvant: Often prescribed with "Sanoot" (Honey or Cumin) to make it palatable and reduce griping.Dosage: Three measures of the soup.3.4.3 Scientific MechanismSennosides: Anthraquinone glycosides that irritate the colonic lining to stimulate peristalsis. It is a standard modern treatment for constipation.Safety Profile: The Prophet's rejection of Euphorbia (which is toxic/irritating) in favor of Senna demonstrates advanced toxicological awareness.3.5 Truffles (Al-Kam'ah): The Ophthalmic CureClassified as "Manna" (divine sustenance requiring no seed or cultivation), truffles are specific for eye ailments.3.5.1 Textual Evidence and Indications"The Truffle is from the Manna, and its water is a cure for the eye".Indication: Eye infections, inflammation, possibly cataracts or corneal opacities.3.5.2 Application and DosageExtraction: The truffle is roasted or boiled, and the water (juice) is extracted.Administration: Applied as kohl or drops directly into the eye. Scholars like Al-Ghafiqi suggest mixing it with antimony (Ithmid).3.5.3 Scientific MechanismAntimicrobial: Aqueous extracts of Terfezia claveryi show significant activity against Pseudomonas aeruginosa and Staphylococcus aureus, common causes of severe eye infections.Anti-fibrotic: Studies indicate truffle juice reduces fibrosis in trachoma, preventing blindness.3.6 Ajwa Dates (Tamr Ajwa): The Toxin NeutralizerSpecifically the Ajwa variety from the High Lands (Al-Aliya) of Madinah.3.6.1 Textual Evidence and Indications"Whoever eats seven Ajwa dates in the morning will not be harmed by poison or magic on that day".Indication: Prophylaxis against toxins, metabolic health, spiritual protection.3.6.2 Application and DosageDose: Seven dates.Timing: Morning, on an empty stomach.3.6.3 Scientific MechanismAntioxidant/Hepatoprotective: High in flavonoids and polyphenols. Studies show Ajwa dates protect the liver against chemical toxicity (e.g., diclofenac) and improve hemoglobin levels in anemia.Cardiovascular: Reduces cholesterol and arterial stiffness.3.7 Talbina (Barley Broth): The Psychotropic FoodA porridge made from barley flour, milk, and honey.3.7.1 Textual Evidence and Indications"Talbina soothes the heart of the patient and relieves some of his sorrow and grief".Indication: Depression, grief, convalescence, weakness.3.7.2 Application and DosageRecipe: 2 spoons of barley flour cooked with 1 cup of milk, sweetened with honey.3.7.3 Scientific MechanismTryptophan-Serotonin Pathway: Barley is rich in tryptophan, a precursor to serotonin, the neurotransmitter regulating mood.Nutritional: High fiber (beta-glucan) lowers cholesterol and stabilizes blood sugar, preventing "sugar crash" induced mood swings.3.8 Camel Milk and Urine: The Hepatic ProtocolA controversial yet strictly authenticated remedy for severe abdominal dropsy and liver failure.3.8.1 Textual Evidence and IndicationsA group from Ukl/Uraina arrived in Madinah, fell ill with dropsy (distended abdomens). The Prophet ordered them to drink the milk and urine of camels. They recovered completely.Indication: Ascites (fluid retention), Liver disease, Cancer (modern deduction).3.8.2 Scientific MechanismCytotoxicity: Research shows camel urine (specifically from virgin camels grazing on desert shrubs) induces apoptosis in cancer cells (e.g., 4T1 breast cancer lines) via downregulation of survivin and beta-catenin.Diuretic: Potent diuretic effect clears ascites.Warning: The WHO advises against raw consumption due to MERS-CoV. The AI must present the Hadith alongside this modern biological safety warning.3.9 Olive Oil (Zayt): The Blessed Tree"Eat the oil (of olive) and use it on your hair and skin, for it comes from a blessed tree".3.9.1 IndicationsDermatology: Leprosy, rash, dry skin.Internal: Pleurisy (mixed with Wars plant and oil), hemorrhoids, poison.3.9.2 Scientific MechanismPolyphenols: Oleocanthal in olive oil has anti-inflammatory properties similar to ibuprofen.Dermatological: Emollient properties repair the skin barrier.3.10 Cow's Milk: The Cure and The WarningThe Prophet said: "Allah has not created a disease without creating a cure... Drink cow's milk, for it eats from all kinds of trees." However, he also warned: "Its milk is a cure, its butter is a remedy, but its meat is a disease".3.10.1 AI Logic for "Beef"Conflict: The Prophet sacrificed a cow for his wives, yet called the meat a disease.Resolution: Scholars interpret the warning as referring to excessive consumption or the meat of cows that graze on unhealthy fodder. The milk is universally praised as a "cocktail" of beneficial plant properties derived from the cow's grazing.AI Output: Recommend Cow's Milk for general health/immunity. Advise moderation with Beef.3.11 Henna (Hinna): The Topical Analgesic"Whenever the Prophet suffered from a headache, he applied Henna to his head".3.11.1 IndicationsHeadache: Applied as a cooling paste.Wounds/Ulcers: Promotes healing of chronic ulcers and burns.Fungal Infection: Applied to the feet (dying the nails/skin).3.11.2 MechanismThermal Regulation: Henna has a cooling effect, counteracting the vasodilation associated with migraines.Antimicrobial: Lawsone (active compound) has antifungal and antibacterial properties.3.12 Siwak (Miswak): Oral Hygiene"If it were not for overburdening my Ummah, I would have ordered them to use Siwak at every prayer".3.12.1 MechanismChemical Debridement: Salvadora persica releases natural fluoride, silica, and sulfur.Antibacterial: Extract inhibits Streptococcus mutans and Porphyromonas gingivalis (gum disease).3.13 Ithmid (Antimony Kohl): Ocular Health"The best of your kohl is Ithmid, for it improves the eyesight and makes the eyelashes grow".3.13.1 MechanismStimulation: Traditionally believed to stimulate the hair follicles.Safety: The AI must warn against lead-based kohl often sold as Ithmid. Authentic Ithmid is Antimony Sulfide, which is distinct from lead.3.14 The Fly Wing Protocol"If a housefly falls into the drink... dip it all in... for one wing has the disease and the other has the cure".3.14.1 Scientific ContextMicrobiology: The surface of insect wings contains nanopillars that physically rupture bacteria upon contact.Bacteriophages: The fly carries bacteriophages (viruses that kill bacteria) which can neutralize pathogens like E. coli released by the fly. This is a critical "apologetic" insight for the AI to provide when users question the hygiene of this Hadith.4. Therapeutic Procedures and Manual Interventions4.1 Hijama (Cupping Therapy)"Healing is in three things: A gulp of honey, cupping, and branding with fire... but I forbid branding".4.1.1 ProtocolsPoints:Kahil (Base of neck/Upper back) - General systemic.Akhda'ain (Veins on side of neck) - Headaches/Pressure.Dahr al-Qadam (Top of foot) - Leg pain/systemic.Timing: The 17th, 19th, and 21st of the lunar month. Mondays, Tuesdays, Thursdays are preferred. Wednesdays are discouraged (some Hadith link it to the trial of Job/Ayyub).Mechanism:Pain-Gate Theory: Suction stimulates non-nociceptive fibers, blocking pain signals.Detoxification: Removal of oxidants and heavy metals from interstitial fluid.Immunomodulation: Increases interferon and lymph production.4.2 Cauterization (Kayy)While mentioned as a cure, it is the "last resort" and generally discouraged ("I forbid my followers..."). It was used historically to stop bleeding (hemostasis) or destroy necrotic tissue. The AI should flag this as "Restricted/Last Resort" logic.5. Spiritual Therapeutics: Ruqyah and AdhkarFor ailments categorized as "Spiritual" (Evil Eye, Magic) or idiopathic pain.5.1 Pain Relief ProtocolAction: Place hand on pain site.Recitation: "Bismillah" (3x). "A'udhu Billahi wa qudratihi min sharri ma ajidu wa uhadhir" (7x).5.2 The Evil Eye (Al-Ayn)Diagnosis: Sudden illness, pale face, heavy chest.Cure: Ruqyah (Surah Falaq/Nas). Washing: The one who cast the eye washes their face/arms/feet, and the water is poured over the victim.Prevention: Eating 7 Ajwa dates.6. Implementation Logic for AI Chatbot DevelopmentTo satisfy the user's request for a chatbot architecture, we must translate this medical corpus into a structured logic flow.Table 5: Symptom-to-Remedy Mapping Table (Logic Gate)User Input (Symptom/Disease)Primary Prophetic RemedyApplication MethodSecondary Support / ContextAbdominal Pain / DiarrheaHoney (Asal)Drink with water (repeat doses).Hadith of the brother's stomach. Persistence is key.ConstipationSenna (Sana)Tea (Decoction).Hadith of "Cure for death". Use milder than Euphorbia.Sore Throat / TonsillitisIndian Costus (Qust)Nasal drops (Sa'ut).Do not press tonsils. Anti-inflammatory.Pleurisy (Chest Pain)Indian Costus (Qust)Side of mouth (Ladud)."7 Cures" Hadith.FeverWaterCold compress / Bath."Fever is from Hell". Principle of Opposites.Headache / MigraineHijama (Cupping)Head/Neck points.Applied by Prophet during Ihram.Headache (Topical)HennaPaste on head.Cooling effect.Grief / DepressionTalbina (Barley)Porridge.Increases Serotonin. "Soothes the heart".Eye Infection / BlindnessTruffle WaterEye drops."Manna". Anti-fibrotic.Poisoning / ToxinsAjwa Dates7 dates in morning.Preventive & curative.SciaticaSheep Tail FatMelted, drank over 3 days.Lipid nutritional therapy for nerve health.Ascites / Liver DiseaseCamel Milk & UrineDrink mixture.Warning: MERS-CoV risk in raw consumption.Wounds / CutsHennaPaste.Promotes clotting and healing.General PainRuqyahHand on site + Dua."A'udhu Billahi..."Epidemic / PlagueQuarantineStay in place.Do not enter/leave infected land.Kidney / UTIBarley WaterDrink boiled barley water.Flushes toxins.Oral HygieneSiwakBrush teeth/gums.Antibacterial.Itching / Skin DiseaseOlive OilTopical."Blessed Tree".Itching (Men)Silk ClothingWear silk.Permitted exception for men with scabies.
"""

# Google Gemini Setup
genai.configure(api_key=api_key)
model = genai.GenerativeModel('gemini-1.5-flash',
    system_instruction="You are a Prophetic Medicine expert based on the provided text. Answer clearly in Malayalam. If the answer is not in the text, say you don't know.")

# --- App Design ---
st.set_page_config(page_title="Prophetic Medicine AI", page_icon="üåø")

st.title("üåø Prophetic Medicine AI Bot")
st.write("‡¥∞‡µã‡¥ó‡¥≤‡¥ï‡µç‡¥∑‡¥£‡¥ô‡µç‡¥ô‡µæ ‡¥§‡¥æ‡¥¥‡µÜ ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï (Voice or Text)")

# --- Chat Logic ---
# Voice Input Hack: Use Mobile Keyboard Mic
user_query = st.text_area("‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥ö‡µã‡¥¶‡µç‡¥Ø‡¥Ç ‡¥á‡¥µ‡¥ø‡¥ü‡µÜ ‡¥ü‡µà‡¥™‡µç‡¥™‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï (‡¥Ö‡¥≤‡µç‡¥≤‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥ï‡µÄ‡¥¨‡µã‡µº‡¥°‡¥ø‡¥≤‡µÜ ‡¥Æ‡µà‡¥ï‡µç‡¥ï‡µç ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ö‡µç‡¥ö‡µç ‡¥™‡¥±‡¥Ø‡µÅ‡¥ï):")

if st.button("‡¥Æ‡¥±‡µÅ‡¥™‡¥ü‡¥ø ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï (Get Remedy)"):
    if user_query:
        with st.spinner('‡¥§‡¥ø‡¥∞‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ...'):
            try:
                # Ask Gemini
                prompt = f"Context: {pdf_content} \n\n User Question: {user_query} \n\n Answer in Malayalam."
                response = model.generate_content(prompt)
                answer_text = response.text
                
                # Show Answer
                st.success("‡¥™‡¥∞‡¥ø‡¥π‡¥æ‡¥∞‡¥µ‡¥ø‡¥ß‡¥ø‡¥ï‡µæ:")
                st.write(answer_text)
                
                # Voice Output (Audio)
                try:
                    tts = gTTS(text=answer_text, lang='ml')
                    tts.save("audio.mp3")
                    st.audio("audio.mp3")
                except:
                    st.warning("‡¥ì‡¥°‡¥ø‡¥Ø‡µã ‡¥™‡µç‡¥∞‡¥µ‡µº‡¥§‡µç‡¥§‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥ø‡¥≤‡µç‡¥≤, ‡¥ü‡µÜ‡¥ï‡µç‡¥∏‡µç‡¥±‡µç‡¥±‡µç ‡¥µ‡¥æ‡¥Ø‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï.")
                    
            except Exception as e:
                st.error(f"Error: {e}")
    else:
        st.warning("‡¥¶‡¥Ø‡¥µ‡¥æ‡¥Ø‡¥ø ‡¥é‡¥®‡µç‡¥§‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡¥≤‡µÅ‡¥Ç ‡¥ö‡µã‡¥¶‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï.")

st.markdown("---")
st.caption("Created for College Exhibition")
